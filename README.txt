-- README.txt – Intelligent Database Assignment
-- Student: Mukandayisenga Marie Chantal
-- Course: Intelligent Databases
-- Date: 01 November 2025

-- 1. Declarative Constraints – Safe Prescriptions
-- ------------------------------------------------
-- Objective: Enforce prescription safety using declarative constraints.
-- Tables: patient, patient_med
-- Constraints:
--   - NOT NULL on patient_id, med_name
--   - CHECK (dose_mg >= 0)
--   - CHECK (start_dt <= end_dt) when both not null
--   - FOREIGN KEY (patient_id) REFERENCES patient(id)
-- Validation:
--   -  Passing INSERT: valid dose and dates
--   -  Failing INSERTs: negative dose, inverted dates

-- 2. Active Databases – Statement-Level Trigger for Bill Totals
-- --------------------------------------------------------------
-- Objective: Recompute BILL.TOTAL once per statement and insert audit rows.
-- Tables: bill, bill_item, bill_audit
-- Trigger Architecture:
--   - Temporary table: bill_ids_temp
--   - Row-level trigger: collects affected BILL_IDs
--   - Statement-level trigger: recomputes totals and inserts audit
-- Notes:
--   - Avoids mutating-table errors
--   - Recomputes once per BILL_ID
--   - Inserts audit record with old and new totals

-- 3. Deductive Databases – Supervision Chain
-- ------------------------------------------
-- Objective: Find top supervisor and hops using recursive SQL.
-- Table: staff_supervisor
-- Query Logic:
--   - Recursive CTE with cycle guard
--   - Hop counter starts at 1
--   - Final selection uses MAX(hops) per employee
-- Output: (EMP, TOP_SUPERVISOR, HOPS)

-- 4. Knowledge Bases – Infectious Disease Roll-Up
-- -----------------------------------------------
-- Objective: Identify patients with diagnosis isA* InfectiousDisease.
-- Table: triple(s,p,o)
-- Query Logic:
--   - Recursive isA closure
--   - Final filter on hasDiagnosis and category = 'InfectiousDisease'
-- Output: Patient IDs with infectious diseases

-- 5. Spatial Databases – Clinics Within Radius and Nearest 3
-- -----------------------------------------------------------
-- Objective: Use PostGIS to find clinics near ambulance location.
-- Table: clinic(id, name, geom)
-- Index: Spatial index on geom
-- Queries:
--   - ST_DWithin() for clinics within 1km
--   - ST_Distance() + ORDER BY for nearest 3
-- Notes:
--   - SRID 4326 used correctly
--   - Point order (lon, lat) respected
--   - Distance in degrees (~1km)

-- Final Remarks:
-- --------------
-- Tasks 1, 3, 4, and 5 are complete and correct.
--  Task 2 refactored using row + statement trigger architecture.
-- Overall: Assignment demonstrates strong mastery of SQL constraints,
-- triggers, recursion, semantic modeling, and spatial queries.
--  Assignment demonstrates strong mastery of:
--    - Avoids mutating-table errors
--    - Recomputes totals once per BILL_ID
--    - Inserts audit records correctly
--   - SQL declarative constraints
--   - Trigger-based automation (E–C–A logic)
--   - Recursive query design and cycle detection
--   - Ontology-aware reasoning with triples
--   - Spatial indexing and proximity analysis using PostGIS